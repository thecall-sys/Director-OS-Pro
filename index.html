<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <title>Director OS Pro V2.5 | 完整功能演示版</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/reactflow@11.10.1/dist/react-flow-renderer.standalone.production.min.js"></script>
    
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;700;900&display=swap');
        body { margin: 0; background: #050505; color: #eee; font-family: 'Inter', sans-serif; overflow: hidden; }
        .sidebar { background: rgba(10, 10, 10, 0.9); backdrop-filter: blur(20px); border-right: 1px solid #222; z-index: 50; }
        .glass-card { background: rgba(255, 255, 255, 0.03); border: 1px solid rgba(255, 255, 255, 0.08); border-radius: 20px; }
        /* 还原 V2.0 标志性的流光连线 */
        .react-flow__edge-path { stroke: #3b82f6; stroke-width: 3; filter: drop-shadow(0 0 5px rgba(59, 130, 246, 0.5)); }
        .react-flow__handle { width: 8px; height: 8px; background: #3b82f6; }
        .cinema-overlay { background: rgba(0,0,0,0.9); z-index: 100; transition: all 0.5s cubic-bezier(0.4, 0, 0.2, 1); }
        select, textarea { background: #151515 !important; border: 1px solid #333 !important; border-radius: 12px !important; color: white !important; }
    </style>
</head>
<body>
    <div id="root" style="width: 100vw; height: 100vh;"></div>

    <script>
        const { useState, useCallback, useEffect, useMemo } = React;
        const ReactFlow = ReactFlowRenderer.default;
        const { Background, Controls, Handle, Position } = ReactFlowRenderer;

        // --- 自定义分镜节点 (V2.5 核心 UI) ---
        const ShotNode = ({ data }) => {
            return React.createElement("div", { className: "bg-[#0d0d0d] border border-white/10 rounded-2xl overflow-hidden w-[320px] shadow-2xl" }, [
                React.createElement(Handle, { type: "target", position: Position.Left }),
                // 画面区
                React.createElement("div", { className: "aspect-video bg-black relative group" }, [
                    React.createElement("div", { className: "absolute top-3 left-3 bg-blue-600 px-2 py-0.5 rounded text-[9px] font-black italic shadow-lg" }, `#SHOT-0${data.id}`),
                    React.createElement("div", { className: "absolute inset-0 bg-blue-600/20 opacity-0 group-hover:opacity-100 transition-opacity flex items-center justify-center cursor-pointer", onClick: data.onPreview }, 
                        React.createElement("div", { className: "bg-white text-black px-4 py-1.5 rounded-full text-[10px] font-black" }, "PREVIEW MOTION")
                    ),
                    React.createElement("i", { "data-lucide": "clapperboard", className: "w-8 h-8 text-white/10 absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2" })
                ]),
                // 数据区
                React.createElement("div", { className: "p-4 space-y-2" }, [
                    React.createElement("div", { className: "flex justify-between items-center" }, [
                        React.createElement("span", { className: "text-[10px] text-blue-400 font-black uppercase tracking-widest" }, data.shotSize || "中景"),
                        React.createElement("span", { className: "text-[10px] text-green-500 font-mono" }, (data.duration || "2.5") + "s")
                    ]),
                    React.createElement("p", { className: "text-[11px] text-gray-400 line-clamp-2 h-8" }, data.description || "等待 AI 扩写分镜细节..."),
                    React.createElement("div", { className: "pt-2 border-t border-white/5 flex justify-between text-[9px] text-gray-600 font-bold uppercase tracking-widest" }, [
                        React.createElement("span", null, data.motion || "固定镜头"),
                        React.createElement("span", null, "Audio: 同步")
                    ])
                ]),
                React.createElement(Handle, { type: "source", position: Position.Right })
            ]);
        };

        const nodeTypes = { shotNode: ShotNode };

        function DirectorOS() {
            const [nodes, setNodes] = useState([]);
            const [edges, setEdges] = useState([]);
            const [script, setScript] = useState("");
            const [cinemaMode, setCinemaMode] = useState(false);
            
            // 核心参数维度
            const [params, setParams] = useState({
                style: "电影写实",
                motion: "推拉镜头",
                atmosphere: "体积雾"
            });

            // 智能生成 9 宫格逻辑 (V2.5 流程)
            const handleExpand = () => {
                if(!script) return alert("请输入剧本创意");
                
                const newNodes = Array.from({ length: 9 }).map((_, i) => ({
                    id: `shot-${i}`,
                    type: 'shotNode',
                    position: { x: 450 + (i % 3) * 380, y: Math.floor(i / 3) * 320 },
                    data: { 
                        id: i + 1, 
                        shotSize: i % 2 === 0 ? "全景" : "特写",
                        description: `[${params.style}] 在场景中展现${script}的视觉细节...`,
                        motion: params.motion,
                        duration: 2.5 + (i * 0.2),
                        onPreview: () => setCinemaMode(true)
                    }
                }));

                const newEdges = Array.from({ length: 8 }).map((_, i) => ({
                    id: `e${i}-${i+1}`, source: `shot-${i}`, target: `shot-${i+1}`, animated: true
                }));

                setNodes(newNodes);
                setEdges(newEdges);
                setTimeout(() => lucide.createIcons(), 100);
            };

            return React.createElement("div", { className: "flex h-full w-full" }, [
                
                // 1. 专业侧边栏
                React.createElement("aside", { className: "sidebar w-[380px] p-8 flex flex-col gap-6" }, [
                    React.createElement("div", { className: "flex items-center gap-3 mb-4" }, [
                        React.createElement("div", { className: "w-10 h-10 bg-blue-600 rounded-xl flex items-center justify-center shadow-lg" }, 
                            React.createElement("i", { "data-lucide": "clapperboard", className: "text-white w-6 h-6" })),
                        React.createElement("h1", { className: "text-xl font-black italic tracking-tighter" }, "DIRECTOR OS V2.5")
                    ]),

                    // 任务参数设定区
                    React.createElement("div", { className: "glass-card p-5 space-y-4" }, [
                        React.createElement("h2", { className: "text-[10px] font-black text-gray-500 uppercase tracking-widest" }, "任务参数设定"),
                        
                        React.createElement("div", { className: "space-y-2" }, [
                            React.createElement("p", { className: "text-[11px] text-gray-400" }, "风格偏好 Style"),
                            React.createElement("select", { className: "w-full p-2.5 text-xs outline-none", onChange: e => setParams({...params, style: e.target.value}) }, 
                                ["电影写实", "赛博朋克", "复古胶片", "日系动漫"].map(o => React.createElement("option", null, o)))
                        ]),

                        React.createElement("div", { className: "space-y-2" }, [
                            React.createElement("p", { className: "text-[11px] text-gray-400" }, "运镜偏好 Motion"),
                            React.createElement("select", { className: "w-full p-2.5 text-xs outline-none", onChange: e => setParams({...params, motion: e.target.value}) }, 
                                ["推拉镜头", "固定镜头", "希区柯克变焦", "环绕拍摄"].map(o => React.createElement("option", null, o)))
                        ]),

                        React.createElement("div", { className: "space-y-2" }, [
                            React.createElement("p", { className: "text-[11px] text-gray-400" }, "光影与氛围 Atmosphere"),
                            React.createElement("div", { className: "flex flex-wrap gap-2" }, 
                                ["伦勃朗光", "体积雾", "冷暖对比"].map(tag => 
                                    React.createElement("span", { className: "px-2.5 py-1 bg-blue-600/10 border border-blue-600/20 rounded-md text-[10px] text-blue-500 font-bold" }, tag)))
                        ])
                    ]),

                    React.createElement("textarea", { 
                        className: "w-full h-32 p-4 text-xs outline-none focus:border-blue-500 transition-all",
                        placeholder: "在此输入创意剧本...",
                        onChange: (e) => setScript(e.target.value)
                    }),

                    React.createElement("button", { 
                        className: "w-full bg-blue-600 hover:bg-blue-500 text-white font-black py-4 rounded-2xl text-xs transition-all shadow-xl shadow-blue-500/20",
                        onClick: handleExpand
                    }, "执行智能分镜拆解")
                ]),

                // 2. 主画布 (无限交互核心)
                React.createElement("div", { className: "flex-1 relative" }, [
                    React.createElement(ReactFlow, { 
                        nodes, edges, nodeTypes,
                        onNodesChange: (changes) => {}, // 演示版保持简单
                        fitView: true,
                        style: { background: '#050505' }
                    }, [
                        React.createElement(Background, { color: "#222", gap: 24, variant: "dots" }),
                        React.createElement(Controls, { style: { background: '#111', fill: '#fff' } })
                    ]),
                    
                    // 右上角 API 状态
                    React.createElement("div", { className: "absolute top-8 right-8 flex gap-4" }, [
                        React.createElement("div", { className: "glass-card px-4 py-2 flex items-center gap-2" }, [
                            React.createElement("span", { className: "w-2 h-2 bg-green-500 rounded-full animate-pulse" }),
                            React.createElement("span", { className: "text-[10px] text-gray-400 font-black uppercase" }, "Seedance 2.0 Ready")
                        ]),
                        React.createElement("button", { className: "glass-card px-6 py-2 text-[10px] font-black uppercase hover:bg-white/10" }, "导出技术分镜表 (.XLSX)")
                    ])
                ]),

                // 3. Cinema Preview (首映模式)
                cinemaMode && React.createElement("div", { 
                    className: "fixed inset-0 cinema-overlay flex items-center justify-center p-20",
                    onClick: () => setCinemaMode(false)
                }, [
                    React.createElement("div", { className: "w-full max-w-6xl aspect-video glass-card overflow-hidden flex flex-col shadow-[0_0_100px_rgba(59,130,246,0.3)] animate-in fade-in zoom-in duration-300" }, [
                        React.createElement("div", { className: "h-14 border-b border-white/10 flex items-center px-8 justify-between bg-white/5" }, [
                            React.createElement("span", { className: "text-xs font-black text-blue-500 tracking-widest uppercase" }, "Seedance 2.0 Dynamic Preview"),
                            React.createElement("span", { className: "text-[10px] text-gray-500 font-bold" }, "STYLE: CINEMATIC | MOTION: DOLLY IN")
                        ]),
                        React.createElement("div", { className: "flex-1 flex items-center justify-center bg-black" }, 
                            React.createElement("i", { "data-lucide": "play", className: "w-20 h-20 text-white/10 animate-pulse" })
                        ),
                        React.createElement("div", { className: "p-6 bg-black/60 flex flex-col gap-2" }, [
                            React.createElement("div", { className: "h-1 bg-white/10 rounded-full overflow-hidden" }, React.createElement("div", { className: "w-1/3 h-full bg-blue-600" })),
                            React.createElement("p", { className: "text-[10px] text-gray-400 italic" }, "正在加载 Seedance 2.0 渲染流... 2.5s 动态路径已生成")
                        ])
                    ])
                ])
            ]);
        }

        // 渲染挂载
        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(React.createElement(DirectorOS));
        
        // 初始化 Lucide 图标
        window.onload = () => lucide.createIcons();
    </script>
</body>
</html>
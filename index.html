<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <title>Director OS Pro V2.5 | 工业级分镜系统</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://unpkg.com/reactflow@11.10.1/dist/style.css">
    
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;700;900&display=swap');
        body, html, #root { margin: 0; padding: 0; width: 100%; height: 100%; background: #050505; color: #eee; font-family: 'Inter', sans-serif; overflow: hidden; }
        .sidebar { background: rgba(10, 10, 10, 0.9); backdrop-filter: blur(20px); border-right: 1px solid #222; z-index: 50; }
        .glass-card { background: rgba(255, 255, 255, 0.03); border: 1px solid rgba(255, 255, 255, 0.08); border-radius: 20px; }
        .react-flow__edge-path { stroke: #3b82f6; stroke-width: 3; filter: drop-shadow(0 0 5px rgba(59, 130, 246, 0.5)); }
        .cinema-overlay { background: rgba(0,0,0,0.95); z-index: 1000; position: fixed; inset: 0; display: flex; align-items: center; justify-content: center; }
        select, textarea, input { background: #151515 !important; border: 1px solid #333 !important; border-radius: 12px !important; color: white !important; outline: none; }
        select:focus, textarea:focus { border-color: #3b82f6 !important; }
        /* 错误提示层 */
        #error-log { position: fixed; bottom: 10px; left: 10px; color: #ff4444; font-size: 10px; z-index: 9999; pointer-events: none; }
    </style>
</head>
<body>
    <div id="root">
        <div style="display:flex; height:100%; align-items:center; justify-content:center; flex-direction:column; gap:20px;">
            <div style="width:40px; height:40px; border:3px solid #3b82f6; border-top-color:transparent; border-radius:50%; animation:spin 1s linear infinite;"></div>
            <p style="color:#555; font-size:12px; letter-spacing:2px;">DIRECTOR OS V2.5 引擎初始化中...</p>
        </div>
    </div>
    <div id="error-log"></div>

    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/reactflow@11.10.1/dist/react-flow-renderer.standalone.production.min.js"></script>
    <script src="https://unpkg.com/lucide@latest"></script>

    <script>
        // 错误捕捉器：如果白屏，按 F12 可以在 Console 看到原因
        window.onerror = function(msg, url, line) {
            document.getElementById('error-log').innerText = "系统错误: " + msg + " (Line: " + line + ")";
        };

        const { useState, useCallback, useEffect, useMemo } = React;
        const ReactFlow = ReactFlowRenderer.default;
        const { Background, Controls, Handle, Position } = ReactFlowRenderer;

        // --- 自定义分镜节点 (V2.5 核心 UI) ---
        const ShotNode = ({ data }) => {
            return React.createElement("div", { className: "bg-[#0d0d0d] border border-white/10 rounded-2xl overflow-hidden w-[340px] shadow-2xl" }, [
                React.createElement(Handle, { type: "target", position: Position.Left, style: { background: '#3b82f6' } }),
                React.createElement("div", { className: "aspect-video bg-black relative group flex items-center justify-center" }, [
                    React.createElement("div", { className: "absolute top-3 left-3 bg-blue-600 px-2 py-0.5 rounded text-[9px] font-black italic shadow-lg z-10" }, `#SHOT-0${data.id}`),
                    React.createElement("div", { className: "absolute inset-0 bg-blue-600/20 opacity-0 group-hover:opacity-100 transition-opacity flex items-center justify-center cursor-pointer z-20", onClick: data.onPreview }, 
                        React.createElement("div", { className: "bg-white text-black px-4 py-1.5 rounded-full text-[10px] font-black" }, "PREVIEW MOTION")
                    ),
                    React.createElement("div", { className: "text-white/5 font-black text-4xl italic select-none" }, "SCENE")
                ]),
                React.createElement("div", { className: "p-5 space-y-3" }, [
                    React.createElement("div", { className: "flex justify-between items-center" }, [
                        React.createElement("span", { className: "text-[10px] text-blue-400 font-black uppercase tracking-widest bg-blue-400/10 px-2 py-0.5 rounded" }, data.shotSize || "中景"),
                        React.createElement("span", { className: "text-[10px] text-green-500 font-mono font-bold" }, (data.duration || "2.5") + " SEC")
                    ]),
                    React.createElement("p", { className: "text-[11px] text-gray-400 leading-relaxed h-8 line-clamp-2" }, data.description),
                    React.createElement("div", { className: "pt-3 border-t border-white/5 flex justify-between text-[9px] text-gray-600 font-bold uppercase tracking-widest" }, [
                        React.createElement("span", null, data.motion || "固定镜头"),
                        React.createElement("span", null, "Audio: SYNCED")
                    ])
                ]),
                React.createElement(Handle, { type: "source", position: Position.Right, style: { background: '#3b82f6' } })
            ]);
        };

        const nodeTypes = { shotNode: ShotNode };

        function DirectorOS() {
            const [nodes, setNodes] = useState([]);
            const [edges, setEdges] = useState([]);
            const [script, setScript] = useState("");
            const [cinemaMode, setCinemaMode] = useState(false);
            
            const [params, setParams] = useState({
                style: "电影写实",
                motion: "缓慢推镜",
                atmosphere: "体积雾"
            });

            const handleExpand = () => {
                if(!script) return alert("请输入创意脚本内容");
                
                const newNodes = Array.from({ length: 9 }).map((_, i) => ({
                    id: `shot-${i}`,
                    type: 'shotNode',
                    position: { x: 500 + (i % 3) * 450, y: Math.floor(i / 3) * 380 },
                    data: { 
                        id: i + 1, 
                        shotSize: ["远景", "全景", "特写", "中景"][Math.floor(Math.random()*4)],
                        description: `[${params.style}] 在场景中展现 ${script} 的第 ${i+1} 个分镜细节...`,
                        motion: params.motion,
                        duration: (2.0 + Math.random()).toFixed(1),
                        onPreview: () => setCinemaMode(true)
                    }
                }));

                const newEdges = Array.from({ length: 8 }).map((_, i) => ({
                    id: `e${i}-${i+1}`, source: `shot-${i}`, target: `shot-${i+1}`, animated: true, style: { stroke: '#3b82f6' }
                }));

                setNodes(newNodes);
                setEdges(newEdges);
                setTimeout(() => lucide.createIcons(), 200);
            };

            return React.createElement("div", { className: "flex h-full w-full" }, [
                
                // 1. 工业级侧边栏
                React.createElement("aside", { className: "sidebar w-[400px] p-8 flex flex-col gap-8 shadow-2xl" }, [
                    React.createElement("div", { className: "flex items-center gap-3" }, [
                        React.createElement("div", { className: "w-10 h-10 bg-blue-600 rounded-xl flex items-center justify-center shadow-lg shadow-blue-500/30" }, 
                            React.createElement("i", { "data-lucide": "clapperboard", className: "text-white w-6 h-6" })),
                        React.createElement("div", null, [
                            React.createElement("h1", { className: "text-2xl font-black italic tracking-tighter" }, "DIRECTOR OS"),
                            React.createElement("p", { className: "text-[9px] text-gray-500 font-bold tracking-[0.3em] uppercase" }, "PRO V2.5 ACTIVE")
                        ])
                    ]),

                    React.createElement("div", { className: "glass-card p-6 space-y-6" }, [
                        React.createElement("h2", { className: "text-[10px] font-black text-gray-500 uppercase tracking-widest flex items-center gap-2" }, [
                            React.createElement("i", { "data-lucide": "sliders", className: "w-3 h-3" }), "任务参数设定"
                        ]),
                        
                        React.createElement("div", { className: "space-y-2" }, [
                            React.createElement("p", { className: "text-[11px] text-gray-400" }, "风格偏好 Style Preference"),
                            React.createElement("select", { className: "w-full p-3 text-xs outline-none cursor-pointer", onChange: e => setParams({...params, style: e.target.value}) }, 
                                ["电影写实", "复古胶片", "赛博朋克", "日系动漫"].map(o => React.createElement("option", null, o)))
                        ]),

                        React.createElement("div", { className: "space-y-2" }, [
                            React.createElement("p", { className: "text-[11px] text-gray-400" }, "运镜偏好 Motion Preference"),
                            React.createElement("select", { className: "w-full p-3 text-xs outline-none cursor-pointer", onChange: e => setParams({...params, motion: e.target.value}) }, 
                                ["缓慢推镜", "环绕拍摄", "希区柯克变焦", "固定镜头"].map(o => React.createElement("option", null, o)))
                        ])
                    ]),

                    React.createElement("div", { className: "space-y-3" }, [
                        React.createElement("label", { className: "text-[10px] font-black text-gray-500 uppercase tracking-widest" }, "剧本创意输入 Input"),
                        React.createElement("textarea", { 
                            className: "w-full h-40 p-4 text-xs outline-none transition-all leading-relaxed",
                            placeholder: "输入您的创意...",
                            onChange: (e) => setScript(e.target.value)
                        })
                    ]),

                    React.createElement("button", { 
                        className: "w-full bg-blue-600 hover:bg-blue-500 text-white font-black py-4 rounded-2xl text-xs transition-all shadow-xl shadow-blue-500/20 active:scale-95",
                        onClick: handleExpand
                    }, "智能生成 V2.5 分镜连线画布")
                ]),

                // 2. 无限画布区 (V2.0 灵魂交互)
                React.createElement("div", { className: "flex-1 relative" }, [
                    React.createElement(ReactFlow, { 
                        nodes, edges, nodeTypes,
                        fitView: true,
                        minZoom: 0.1,
                        maxZoom: 1.5
                    }, [
                        React.createElement(Background, { color: "#222", gap: 24, variant: "dots" }),
                        React.createElement(Controls, { style: { background: '#111', fill: '#fff', border: '1px solid #333' } })
                    ]),
                    
                    // 右上角 状态仪表盘
                    React.createElement("div", { className: "absolute top-8 right-8 flex gap-4" }, [
                        React.createElement("div", { className: "glass-card px-5 py-2.5 flex items-center gap-2.5 backdrop-blur-md" }, [
                            React.createElement("span", { className: "w-2 h-2 bg-green-500 rounded-full animate-pulse" }),
                            React.createElement("span", { className: "text-[10px] text-gray-400 font-black uppercase tracking-widest" }, "Seedance 2.0 Engine Ready")
                        ]),
                        React.createElement("button", { className: "glass-card px-6 py-2.5 text-[10px] font-black uppercase hover:bg-white/10 transition-all" }, "导出技术分镜表 (.XLSX)")
                    ])
                ]),

                // 3. Cinema Preview (首映模式)
                cinemaMode && React.createElement("div", { 
                    className: "cinema-overlay",
                    onClick: () => setCinemaMode(false)
                }, [
                    React.createElement("div", { className: "w-full max-w-6xl aspect-video glass-card overflow-hidden flex flex-col shadow-[0_0_120px_rgba(59,130,246,0.3)] animate-in fade-in zoom-in duration-300" }, [
                        React.createElement("div", { className: "h-14 border-b border-white/10 flex items-center px-8 justify-between bg-white/5" }, [
                            React.createElement("span", { className: "text-xs font-black text-blue-500 tracking-widest uppercase" }, "Seedance 2.0 动态预演生成中..."),
                            React.createElement("i", { "data-lucide": "x", className: "w-4 h-4 text-gray-500 cursor-pointer" })
                        ]),
                        React.createElement("div", { className: "flex-1 flex items-center justify-center bg-black" }, 
                            React.createElement("i", { "data-lucide": "play", className: "w-24 h-24 text-white/5 animate-pulse" })
                        ),
                        React.createElement("div", { className: "p-8 bg-black/80 flex flex-col gap-4" }, [
                            React.createElement("div", { className: "h-1.5 bg-white/5 rounded-full overflow-hidden" }, React.createElement("div", { className: "w-1/3 h-full bg-blue-600 shadow-[0_0_10px_#3b82f6]" })),
                            React.createElement("div", { className: "flex justify-between" }, [
                                React.createElement("p", { className: "text-[10px] text-gray-400 italic" }, "正在注入运动矢量：DOLLY IN | 时长：2.5s"),
                                React.createElement("p", { className: "text-[10px] text-blue-500 font-bold" }, "34% COMPLETE")
                            ])
                        ])
                    ])
                ])
            ]);
        }

        // 渲染挂载
        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(React.createElement(DirectorOS));
        
        // 自动初始化图标
        setTimeout(() => lucide.createIcons(), 500);
    </script>
</body>
</html>
